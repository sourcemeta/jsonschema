macro(add_jsonschema_test_unix name)
  if(UNIX)
    add_test(NAME JSONSchema.${name} COMMAND
      "${CMAKE_CURRENT_SOURCE_DIR}/${name}.sh"
      "$<TARGET_FILE:jsonschema_cli>")
  endif()
endmacro()

macro(add_jsonschema_test_unix_ci name)
  if(JSONSCHEMA_TESTS_CI AND UNIX)
    add_test(NAME JSONSchema.ci.${name} COMMAND
      "${CMAKE_CURRENT_SOURCE_DIR}/ci/${name}.sh"
      "$<TARGET_FILE:jsonschema_cli>")
  endif()
endmacro()

add_jsonschema_test_unix(version_command)
add_jsonschema_test_unix(version_option_long)
add_jsonschema_test_unix(help_command)
add_jsonschema_test_unix(help_option_long)
add_jsonschema_test_unix(help_option_short)
add_jsonschema_test_unix(unknown_command)
add_jsonschema_test_unix(format_single)
add_jsonschema_test_unix(format_single_keep_ordering)
add_jsonschema_test_unix(format_invalid_path)
add_jsonschema_test_unix(format_directory)
add_jsonschema_test_unix(format_cwd)
add_jsonschema_test_unix(format_multi_extension)
add_jsonschema_test_unix(format_yaml)
add_jsonschema_test_unix(format_check_yaml)
add_jsonschema_test_unix(format_check_single_fail)
add_jsonschema_test_unix(format_check_single_pass)
add_jsonschema_test_unix(format_check_single_pass_keep_ordering)
add_jsonschema_test_unix(format_directory_ignore_directory)
add_jsonschema_test_unix(format_directory_ignore_file)
add_jsonschema_test_unix(format_check_single_invalid)

# Validate
add_jsonschema_test_unix(validate/fail_instance_directory)
add_jsonschema_test_unix(validate/fail_instance_enoent)
add_jsonschema_test_unix(validate/fail_instance_invalid_json)
add_jsonschema_test_unix(validate/fail_invalid_ref)
add_jsonschema_test_unix(validate/fail_no_instance)
add_jsonschema_test_unix(validate/fail_no_schema)
add_jsonschema_test_unix(validate/fail_relative_external_ref_missing)
add_jsonschema_test_unix(validate/fail_resolve_enoent)
add_jsonschema_test_unix(validate/fail_resolve_directory_with_invalid_json)
add_jsonschema_test_unix(validate/fail_resolve_invalid_json)
add_jsonschema_test_unix(validate/fail_schema_directory)
add_jsonschema_test_unix(validate/fail_schema_enoent)
add_jsonschema_test_unix(validate/fail_schema_invalid_json)
add_jsonschema_test_unix(validate/fail_schema_non_schema)
add_jsonschema_test_unix(validate/fail_schema_unknown_dialect)
add_jsonschema_test_unix(validate/fail_jsonl_bigint)
add_jsonschema_test_unix(validate/fail_trace)
add_jsonschema_test_unix(validate/fail_trace_fast)
add_jsonschema_test_unix(validate/pass_trace)
add_jsonschema_test_unix(validate/pass_trace_fast)
add_jsonschema_test_unix(validate/pass_trace_unknown_keyword)
add_jsonschema_test_unix(validate/pass_resolve)
add_jsonschema_test_unix(validate/pass_resolve_custom_extension)
add_jsonschema_test_unix(validate/pass_resolve_without_identifier)
add_jsonschema_test_unix(validate/pass_resolve_verbose)
add_jsonschema_test_unix(validate/pass_verbose)
add_jsonschema_test_unix(validate/pass_draft4)
add_jsonschema_test_unix(validate/pass_draft6)
add_jsonschema_test_unix(validate/pass_draft7)
add_jsonschema_test_unix(validate/pass_2019_09)
add_jsonschema_test_unix(validate/pass_2020_12)
add_jsonschema_test_unix(validate/pass_2020_12_default_dialect)
add_jsonschema_test_unix(validate/pass_2020_12_fast)
add_jsonschema_test_unix(validate/fail_draft4)
add_jsonschema_test_unix(validate/fail_draft6)
add_jsonschema_test_unix(validate/fail_draft7)
add_jsonschema_test_unix(validate/fail_2019_09)
add_jsonschema_test_unix(validate/fail_2020_12)
add_jsonschema_test_unix(validate/fail_2020_12_fast)
add_jsonschema_test_unix(validate/pass_jsonl)
add_jsonschema_test_unix(validate/pass_jsonl_empty)
add_jsonschema_test_unix(validate/pass_jsonl_empty_verbose)
add_jsonschema_test_unix(validate/pass_jsonl_verbose)
add_jsonschema_test_unix(validate/fail_jsonl_invalid_entry)
add_jsonschema_test_unix(validate/fail_jsonl_one)
add_jsonschema_test_unix(validate/fail_jsonl_one_verbose)
add_jsonschema_test_unix(validate/fail_jsonl_all)
add_jsonschema_test_unix(validate/fail_jsonl_all_verbose)
add_jsonschema_test_unix(validate/pass_many)
add_jsonschema_test_unix(validate/pass_many_verbose)
add_jsonschema_test_unix(validate/fail_many)
add_jsonschema_test_unix(validate/fail_many_verbose)
add_jsonschema_test_unix(validate/fail_yaml)
add_jsonschema_test_unix(validate/pass_json_ref_yaml)
add_jsonschema_test_unix(validate/pass_process_substitution)
add_jsonschema_test_unix(validate/pass_2020_12_fast_with_template)
add_jsonschema_test_unix(validate/pass_2020_12_with_template)
add_jsonschema_test_unix(validate/pass_trace_with_template)
add_jsonschema_test_unix(validate/pass_verbose_with_template)
add_jsonschema_test_unix(validate/pass_with_invalid_template)
add_jsonschema_test_unix(validate/pass_with_invalid_template_verbose)
add_jsonschema_test_unix(validate/pass_no_identifier_ref)
add_jsonschema_test_unix(validate/pass_no_identifier_half_ref)
add_jsonschema_test_unix(validate/fail_json)
add_jsonschema_test_unix(validate/pass_json)
add_jsonschema_test_unix(validate/pass_json_fast)
add_jsonschema_test_unix(validate/pass_json_no_identifier)
add_jsonschema_test_unix(validate/pass_jsonl_json)
add_jsonschema_test_unix(validate/pass_jsonl_json_verbose)
add_jsonschema_test_unix(validate/fail_jsonl_one_json)
add_jsonschema_test_unix(validate/fail_jsonl_one_json_verbose)

# Metaschema
add_jsonschema_test_unix(metaschema/pass_trace)
add_jsonschema_test_unix(metaschema/fail_trace)
add_jsonschema_test_unix(metaschema/fail_directory)
add_jsonschema_test_unix(metaschema/fail_single)
add_jsonschema_test_unix(metaschema/fail_yaml)
add_jsonschema_test_unix(metaschema/fail_non_schema)
add_jsonschema_test_unix(metaschema/fail_no_dialect)
add_jsonschema_test_unix(metaschema/pass_cwd)
add_jsonschema_test_unix(metaschema/pass_single)
add_jsonschema_test_unix(metaschema/pass_2020_12)
add_jsonschema_test_unix(metaschema/pass_2020_12_default_dialect)
add_jsonschema_test_unix(metaschema/pass_json)
add_jsonschema_test_unix(metaschema/fail_json)
add_jsonschema_test_unix(metaschema/fail_directory_json)
add_jsonschema_test_unix(metaschema/fail_directory_non_resolved)
add_jsonschema_test_unix(metaschema/pass_2020_12_with_fragment)
add_jsonschema_test_unix(metaschema/pass_draft7_without_fragment)
add_jsonschema_test_unix(metaschema/fail_relative_file_metaschema_ref)

# Test
add_jsonschema_test_unix(test/fail_resolve_directory_non_schema)
add_jsonschema_test_unix(test/fail_additional_properties)
add_jsonschema_test_unix(test/fail_true_single_resolve)
add_jsonschema_test_unix(test/fail_true_single_resolve_verbose)
add_jsonschema_test_unix(test/fail_false_single_resolve)
add_jsonschema_test_unix(test/fail_false_single_resolve_verbose)
add_jsonschema_test_unix(test/fail_multi_test)
add_jsonschema_test_unix(test/fail_multi_resolve)
add_jsonschema_test_unix(test/fail_multi_resolve_verbose)
add_jsonschema_test_unix(test/fail_unresolvable)
add_jsonschema_test_unix(test/fail_unresolvable_fragment)
add_jsonschema_test_unix(test/fail_unresolvable_anchor)
add_jsonschema_test_unix(test/fail_not_object)
add_jsonschema_test_unix(test/fail_no_schema)
add_jsonschema_test_unix(test/fail_schema_non_string)
add_jsonschema_test_unix(test/fail_no_tests)
add_jsonschema_test_unix(test/fail_anyof)
add_jsonschema_test_unix(test/fail_tests_non_array)
add_jsonschema_test_unix(test/fail_test_case_non_object)
add_jsonschema_test_unix(test/fail_test_case_no_data)
add_jsonschema_test_unix(test/fail_test_case_data_and_data_path)
add_jsonschema_test_unix(test/fail_test_case_non_string_description)
add_jsonschema_test_unix(test/fail_test_case_non_string_data_path)
add_jsonschema_test_unix(test/fail_test_case_no_valid)
add_jsonschema_test_unix(test/fail_test_case_non_boolean_valid)
add_jsonschema_test_unix(test/fail_true_resolve_fragment)
add_jsonschema_test_unix(test/pass_empty)
add_jsonschema_test_unix(test/pass_empty_verbose)
add_jsonschema_test_unix(test/pass_single_yaml)
add_jsonschema_test_unix(test/pass_single_resolve)
add_jsonschema_test_unix(test/pass_single_resolve_default_dialect)
add_jsonschema_test_unix(test/pass_single_resolve_verbose)
add_jsonschema_test_unix(test/pass_single_resolve_fragment)
add_jsonschema_test_unix(test/pass_single_resolve_fragment_verbose)
add_jsonschema_test_unix(test/pass_single_comment_verbose)
add_jsonschema_test_unix(test/pass_single_no_description_verbose)
add_jsonschema_test_unix(test/pass_single_no_test_description_verbose)
add_jsonschema_test_unix(test/pass_single_data_path)
add_jsonschema_test_unix(test/pass_single_data_path_verbose)
add_jsonschema_test_unix(test/pass_multi_directory_resolve)
add_jsonschema_test_unix(test/pass_multi_directory_resolve_verbose)
add_jsonschema_test_unix(test/pass_file_target)
add_jsonschema_test_unix(test/pass_file_target_fragment)

# Bundle
add_jsonschema_test_unix(bundle/pass_into_resolve_directory)
add_jsonschema_test_unix(bundle/pass_resolve_directory)
add_jsonschema_test_unix(bundle/pass_resolve_directory_verbose)
add_jsonschema_test_unix(bundle/pass_resolve_metaschema)
add_jsonschema_test_unix(bundle/pass_resolve_single)
add_jsonschema_test_unix(bundle/pass_resolve_single_default_dialect)
add_jsonschema_test_unix(bundle/pass_resolve_yaml)
add_jsonschema_test_unix(bundle/pass_resolve_with_ignore)
add_jsonschema_test_unix(bundle/pass_resolve_no_identifier)
add_jsonschema_test_unix(bundle/pass_without_id)
add_jsonschema_test_unix(bundle/pass_without_id_verbose)
add_jsonschema_test_unix(bundle/pass_without_remote)
add_jsonschema_test_unix(bundle/fail_no_schema)
add_jsonschema_test_unix(bundle/fail_relative_external_ref_missing)
add_jsonschema_test_unix(bundle/fail_resolve_duplicate)
add_jsonschema_test_unix(bundle/fail_resolve_invalid_json)
add_jsonschema_test_unix(bundle/fail_schema_invalid_json)
add_jsonschema_test_unix(bundle/fail_unknown_metaschema)
add_jsonschema_test_unix(bundle/fail_bigint)

# Inspect
add_jsonschema_test_unix(inspect/pass)
add_jsonschema_test_unix(inspect/pass_no_identifier)
add_jsonschema_test_unix(inspect/pass_default_dialect)
add_jsonschema_test_unix(inspect/pass_yaml)
add_jsonschema_test_unix(inspect/pass_json_output)
add_jsonschema_test_unix(inspect/fail_no_schema)
add_jsonschema_test_unix(inspect/fail_schema_invalid_json)
add_jsonschema_test_unix(inspect/fail_unknown_metaschema)
add_jsonschema_test_unix(inspect/fail_relative_file_metaschema_ref)

# Compile
add_jsonschema_test_unix(compile/pass)
add_jsonschema_test_unix(compile/pass_no_identifier)
add_jsonschema_test_unix(compile/pass_fast)
add_jsonschema_test_unix(compile/pass_default_dialect)
add_jsonschema_test_unix(compile/pass_yaml)
add_jsonschema_test_unix(compile/fail_no_schema)
add_jsonschema_test_unix(compile/fail_schema_invalid_json)
add_jsonschema_test_unix(compile/fail_unknown_metaschema)

# Lint
add_jsonschema_test_unix(lint/pass_lint_fix)
add_jsonschema_test_unix(lint/pass_lint_no_fix)
add_jsonschema_test_unix(lint/fail_lint)
add_jsonschema_test_unix(lint/fail_lint_default_dialect)
add_jsonschema_test_unix(lint/fail_lint_yaml)
add_jsonschema_test_unix(lint/fail_lint_fix_yaml)
add_jsonschema_test_unix(lint/fail_lint_fix_yml)
add_jsonschema_test_unix(lint/fail_lint_json)
add_jsonschema_test_unix(lint/fail_lint_non_schema)
add_jsonschema_test_unix(lint/fail_lint_non_schema_fix)
add_jsonschema_test_unix(lint/fail_bigint)
add_jsonschema_test_unix(lint/fail_lint_directory_unresolvable)
add_jsonschema_test_unix(lint/fail_lint_directory_unresolvable_fix)
add_jsonschema_test_unix(lint/fail_lint_directory_unresolvable_dialect)
add_jsonschema_test_unix(lint/fail_lint_disable_one)
add_jsonschema_test_unix(lint/fail_lint_disable_one_verbose)
add_jsonschema_test_unix(lint/fail_lint_disable_unknown_verbose)
add_jsonschema_test_unix(lint/fail_lint_disable_many)
add_jsonschema_test_unix(lint/fail_lint_examples)
add_jsonschema_test_unix(lint/fail_lint_default)
add_jsonschema_test_unix(lint/pass_lint_json)
add_jsonschema_test_unix(lint/pass_lint_fix_json)
add_jsonschema_test_unix(lint/pass_lint_ignore_short)
add_jsonschema_test_unix(lint/pass_lint_ignore_long)
add_jsonschema_test_unix(lint/pass_lint_examples_fix)
add_jsonschema_test_unix(lint/pass_lint_examples_no_fix)
add_jsonschema_test_unix(lint/pass_lint_default_fix)
add_jsonschema_test_unix(lint/pass_lint_default_no_fix)
add_jsonschema_test_unix(lint/pass_lint_anonymous_default_with_ref)
add_jsonschema_test_unix(lint/pass_lint_anonymous_nested_default_with_ref)
add_jsonschema_test_unix(lint/pass_lint_default_nested_with_id)
add_jsonschema_test_unix(lint/pass_lint_examples_nested_with_id)
add_jsonschema_test_unix(lint/pass_lint_list_exclude)
add_jsonschema_test_unix(lint/pass_lint_list_long)
add_jsonschema_test_unix(lint/pass_lint_list_short)
add_jsonschema_test_unix(lint/pass_lint_fix_no_reformat)
add_jsonschema_test_unix(lint/pass_lint_directory_resolve_many)
add_jsonschema_test_unix(lint/pass_lint_direct_custom_extension)

# Encode
add_jsonschema_test_unix(encode/pass_schema_less)
add_jsonschema_test_unix(encode/pass_schema_less_jsonl)
add_jsonschema_test_unix(encode/pass_schema_less_jsonl_verbose)
add_jsonschema_test_unix(encode/fail_no_document)
add_jsonschema_test_unix(encode/fail_no_output)

# Decode
add_jsonschema_test_unix(decode/pass_schema_less)
add_jsonschema_test_unix(decode/pass_schema_less_jsonl)
add_jsonschema_test_unix(decode/pass_schema_less_jsonl_verbose)
add_jsonschema_test_unix(decode/fail_no_document)
add_jsonschema_test_unix(decode/fail_no_output)

# CI specific tests
add_jsonschema_test_unix_ci(pass_bundle_http)
add_jsonschema_test_unix_ci(fail_bundle_http_non_200)
add_jsonschema_test_unix_ci(fail_bundle_http_non_200_verbose)
add_jsonschema_test_unix_ci(fail_bundle_http_non_schema)
add_jsonschema_test_unix_ci(fail_bundle_http_non_schema_verbose)
add_jsonschema_test_unix_ci(fail_validate_http_non_200)
add_jsonschema_test_unix_ci(fail_validate_http_non_200_verbose)
add_jsonschema_test_unix_ci(fail_validate_http_non_schema)
add_jsonschema_test_unix_ci(fail_validate_http_non_schema_verbose)
add_jsonschema_test_unix_ci(pass_validate_http)
add_jsonschema_test_unix_ci(pass_validate_http_verbose)
add_jsonschema_test_unix_ci(precommit_lint)

# TODO: Make this test pass on Linux. It hangs for some reason
if(APPLE)
  add_jsonschema_test_unix_ci(pass_validate_json_ref_yaml_http)
endif()
