macro(add_jsonschema_test_unix name)
  if(UNIX)
    add_test(NAME JSONSchema.${name} COMMAND
      "${CMAKE_CURRENT_SOURCE_DIR}/${name}.sh"
      "$<TARGET_FILE:jsonschema_cli>")
  endif()
endmacro()

macro(add_jsonschema_test_unix_ci name)
  if(JSONSCHEMA_TESTS_CI AND UNIX)
    add_test(NAME JSONSchema.ci.${name} COMMAND
      "${CMAKE_CURRENT_SOURCE_DIR}/ci/${name}.sh"
      "$<TARGET_FILE:jsonschema_cli>")
  endif()
endmacro()

add_jsonschema_test_unix(help)
add_jsonschema_test_unix(format_single)
add_jsonschema_test_unix(format_invalid_path)
add_jsonschema_test_unix(format_directory)
add_jsonschema_test_unix(format_cwd)
add_jsonschema_test_unix(format_multi_extension)
add_jsonschema_test_unix(format_check_single_fail)
add_jsonschema_test_unix(format_check_single_pass)
add_jsonschema_test_unix(format_directory_ignore_directory)
add_jsonschema_test_unix(format_directory_ignore_file)
add_jsonschema_test_unix(format_check_single_invalid)

# Validate
add_jsonschema_test_unix(validate/fail_instance_directory)
add_jsonschema_test_unix(validate/fail_instance_enoent)
add_jsonschema_test_unix(validate/fail_instance_invalid_json)
add_jsonschema_test_unix(validate/fail_invalid_ref)
add_jsonschema_test_unix(validate/fail_no_instance)
add_jsonschema_test_unix(validate/fail_no_schema)
add_jsonschema_test_unix(validate/fail_relative_external_ref_missing)
add_jsonschema_test_unix(validate/fail_resolve_enoent)
add_jsonschema_test_unix(validate/fail_resolve_directory_with_invalid_json)
add_jsonschema_test_unix(validate/fail_resolve_invalid_json)
add_jsonschema_test_unix(validate/fail_schema_directory)
add_jsonschema_test_unix(validate/fail_schema_enoent)
add_jsonschema_test_unix(validate/fail_schema_invalid_json)
add_jsonschema_test_unix(validate/fail_schema_non_schema)
add_jsonschema_test_unix(validate/fail_schema_unknown_dialect)
add_jsonschema_test_unix(validate/fail_trace)
add_jsonschema_test_unix(validate/pass_trace)
add_jsonschema_test_unix(validate/pass_resolve)
add_jsonschema_test_unix(validate/pass_resolve_custom_extension)
add_jsonschema_test_unix(validate/pass_resolve_verbose)
add_jsonschema_test_unix(validate/pass_verbose)
add_jsonschema_test_unix(validate/pass_draft4)
add_jsonschema_test_unix(validate/pass_draft6)
add_jsonschema_test_unix(validate/pass_draft7)
add_jsonschema_test_unix(validate/pass_2019_09)
add_jsonschema_test_unix(validate/pass_2020_12)
add_jsonschema_test_unix(validate/fail_draft4)
add_jsonschema_test_unix(validate/fail_draft6)
add_jsonschema_test_unix(validate/fail_draft7)
add_jsonschema_test_unix(validate/fail_2019_09)
add_jsonschema_test_unix(validate/fail_2020_12)
add_jsonschema_test_unix(validate/pass_jsonl)
add_jsonschema_test_unix(validate/pass_jsonl_empty)
add_jsonschema_test_unix(validate/pass_jsonl_empty_verbose)
add_jsonschema_test_unix(validate/pass_jsonl_verbose)
add_jsonschema_test_unix(validate/fail_jsonl_invalid_entry)
add_jsonschema_test_unix(validate/fail_jsonl_one)
add_jsonschema_test_unix(validate/fail_jsonl_one_verbose)
add_jsonschema_test_unix(validate/fail_jsonl_all)
add_jsonschema_test_unix(validate/fail_jsonl_all_verbose)
add_jsonschema_test_unix(validate/pass_many)
add_jsonschema_test_unix(validate/pass_many_verbose)
add_jsonschema_test_unix(validate/fail_many)
add_jsonschema_test_unix(validate/fail_many_verbose)

# Metaschema
add_jsonschema_test_unix(metaschema/pass_trace)
add_jsonschema_test_unix(metaschema/fail_trace)
add_jsonschema_test_unix(metaschema/fail_directory)
add_jsonschema_test_unix(metaschema/fail_single)
add_jsonschema_test_unix(metaschema/fail_non_schema)
add_jsonschema_test_unix(metaschema/pass_cwd)
add_jsonschema_test_unix(metaschema/pass_single)
add_jsonschema_test_unix(metaschema/pass_2020_12)

# Test
add_jsonschema_test_unix(test/fail_resolve_directory_non_schema)
add_jsonschema_test_unix(test/fail_additional_properties)
add_jsonschema_test_unix(test/fail_true_single_resolve)
add_jsonschema_test_unix(test/fail_true_single_resolve_verbose)
add_jsonschema_test_unix(test/fail_false_single_resolve)
add_jsonschema_test_unix(test/fail_false_single_resolve_verbose)
add_jsonschema_test_unix(test/fail_multi_resolve)
add_jsonschema_test_unix(test/fail_multi_resolve_verbose)
add_jsonschema_test_unix(test/fail_unresolvable)
add_jsonschema_test_unix(test/fail_unresolvable_fragment)
add_jsonschema_test_unix(test/fail_unresolvable_anchor)
add_jsonschema_test_unix(test/fail_not_object)
add_jsonschema_test_unix(test/fail_no_schema)
add_jsonschema_test_unix(test/fail_schema_non_string)
add_jsonschema_test_unix(test/fail_no_tests)
add_jsonschema_test_unix(test/fail_tests_non_array)
add_jsonschema_test_unix(test/fail_test_case_non_object)
add_jsonschema_test_unix(test/fail_test_case_no_data)
add_jsonschema_test_unix(test/fail_test_case_data_and_data_path)
add_jsonschema_test_unix(test/fail_test_case_non_string_description)
add_jsonschema_test_unix(test/fail_test_case_non_string_data_path)
add_jsonschema_test_unix(test/fail_test_case_no_valid)
add_jsonschema_test_unix(test/fail_test_case_non_boolean_valid)
add_jsonschema_test_unix(test/fail_true_resolve_fragment)
add_jsonschema_test_unix(test/pass_empty)
add_jsonschema_test_unix(test/pass_empty_verbose)
add_jsonschema_test_unix(test/pass_single_resolve)
add_jsonschema_test_unix(test/pass_single_resolve_verbose)
add_jsonschema_test_unix(test/pass_single_resolve_fragment)
add_jsonschema_test_unix(test/pass_single_resolve_fragment_verbose)
add_jsonschema_test_unix(test/pass_single_comment_verbose)
add_jsonschema_test_unix(test/pass_single_no_description_verbose)
add_jsonschema_test_unix(test/pass_single_no_test_description_verbose)
add_jsonschema_test_unix(test/pass_single_data_path)
add_jsonschema_test_unix(test/pass_single_data_path_verbose)
add_jsonschema_test_unix(test/pass_multi_directory_resolve)
add_jsonschema_test_unix(test/pass_multi_directory_resolve_verbose)

# Bundle
add_jsonschema_test_unix(bundle/pass_into_resolve_directory)
add_jsonschema_test_unix(bundle/pass_resolve_directory)
add_jsonschema_test_unix(bundle/pass_resolve_directory_verbose)
add_jsonschema_test_unix(bundle/pass_resolve_metaschema)
add_jsonschema_test_unix(bundle/pass_resolve_single)
add_jsonschema_test_unix(bundle/pass_resolve_with_ignore)
add_jsonschema_test_unix(bundle/pass_without_id)
add_jsonschema_test_unix(bundle/pass_without_id_verbose)
add_jsonschema_test_unix(bundle/pass_without_remote)
add_jsonschema_test_unix(bundle/fail_no_schema)
add_jsonschema_test_unix(bundle/fail_relative_external_ref_missing)
add_jsonschema_test_unix(bundle/fail_resolve_duplicate)
add_jsonschema_test_unix(bundle/fail_resolve_invalid_json)
add_jsonschema_test_unix(bundle/fail_schema_invalid_json)
add_jsonschema_test_unix(bundle/fail_unknown_metaschema)

# Frame
add_jsonschema_test_unix(frame/pass)
add_jsonschema_test_unix(frame/fail_no_schema)
add_jsonschema_test_unix(frame/fail_schema_invalid_json)
add_jsonschema_test_unix(frame/fail_unknown_metaschema)

# Compile
add_jsonschema_test_unix(compile/pass_1)
add_jsonschema_test_unix(compile/pass_2)
add_jsonschema_test_unix(compile/fail_no_schema)
add_jsonschema_test_unix(compile/fail_schema_invalid_json)
add_jsonschema_test_unix(compile/fail_unknown_metaschema)
add_jsonschema_test_unix(compile/fail_ref_from_unknown_keyword)

# Identify
add_jsonschema_test_unix(identify/fail_resolve_from_no_match)
add_jsonschema_test_unix(identify/fail_resolve_from_equal)
add_jsonschema_test_unix(identify/fail_invalid_id)
add_jsonschema_test_unix(identify/fail_invalid_id_uri)
add_jsonschema_test_unix(identify/fail_invalid_base_uri)
add_jsonschema_test_unix(identify/fail_no_id)
add_jsonschema_test_unix(identify/fail_no_schema)
add_jsonschema_test_unix(identify/pass_with_official_dialect)
add_jsonschema_test_unix(identify/pass_with_official_dialect_verbose)
add_jsonschema_test_unix(identify/pass_with_resolve_from)
add_jsonschema_test_unix(identify/pass_with_resolve_from_verbose)
add_jsonschema_test_unix(identify/pass_with_unknown_dialect)
add_jsonschema_test_unix(identify/pass_with_unknown_dialect_verbose)

# Lint
add_jsonschema_test_unix(lint/pass_lint_fix)
add_jsonschema_test_unix(lint/pass_lint_no_fix)
add_jsonschema_test_unix(lint/fail_lint)

# Canonicalize
add_jsonschema_test_unix(canonicalize/pass_1)
add_jsonschema_test_unix(canonicalize/fail_no_schema)
add_jsonschema_test_unix(canonicalize/fail_schema_invalid_json)
add_jsonschema_test_unix(canonicalize/fail_unknown_metaschema)

# Encode
add_jsonschema_test_unix(encode/pass_schema_less)
add_jsonschema_test_unix(encode/pass_schema_less_jsonl)
add_jsonschema_test_unix(encode/pass_schema_less_jsonl_verbose)
add_jsonschema_test_unix(encode/fail_no_document)
add_jsonschema_test_unix(encode/fail_no_output)

# Decode
add_jsonschema_test_unix(decode/pass_schema_less)
add_jsonschema_test_unix(decode/pass_schema_less_jsonl)
add_jsonschema_test_unix(decode/pass_schema_less_jsonl_verbose)
add_jsonschema_test_unix(decode/fail_no_document)
add_jsonschema_test_unix(decode/fail_no_output)

# CI specific tests
add_jsonschema_test_unix_ci(pass_bundle_http)
add_jsonschema_test_unix_ci(fail_bundle_http_non_200)
add_jsonschema_test_unix_ci(fail_bundle_http_non_200_verbose)
add_jsonschema_test_unix_ci(fail_bundle_http_non_schema)
add_jsonschema_test_unix_ci(fail_bundle_http_non_schema_verbose)
add_jsonschema_test_unix_ci(fail_validate_http_non_200)
add_jsonschema_test_unix_ci(fail_validate_http_non_200_verbose)
add_jsonschema_test_unix_ci(fail_validate_http_non_schema)
add_jsonschema_test_unix_ci(fail_validate_http_non_schema_verbose)
add_jsonschema_test_unix_ci(pass_validate_http)
add_jsonschema_test_unix_ci(pass_validate_http_verbose)
